!function(){"use strict";const t={instructions:"Goal of the game is to press all the buttons in the right order without killing all the cells.\nButtons can kill some cells and create new ones, according to what's writtien on the button.\nEach digit after the S on the button means that a living cell with as much living neighbors will live, otherwise it will die.\nEach digit after the B on the button means that in empty cell with as much living neighbors, a new living cell will appear.\n"};var e,n,l,s,i,o,r={},a=[],u=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function _(t,e){for(var n in e)t[n]=e[n];return t}function c(t){var e=t.parentNode;e&&e.removeChild(t)}function h(t,e,n){var l,s=arguments,i={};for(l in e)"key"!==l&&"ref"!==l&&(i[l]=e[l]);if(arguments.length>3)for(n=[n],l=3;l<arguments.length;l++)n.push(s[l]);if(null!=n&&(i.children=n),"function"==typeof t&&null!=t.defaultProps)for(l in t.defaultProps)void 0===i[l]&&(i[l]=t.defaultProps[l]);return p(t,i,e&&e.key,e&&e.ref,null)}function p(t,n,l,s,i){var o={type:t,props:n,key:l,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:i};return null==i&&(o.__v=o),e.vnode&&e.vnode(o),o}function f(t){return t.children}function d(t,e){this.props=t,this.context=e}function v(t,e){if(null==e)return t.__?v(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?v(t):null}function m(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return m(t)}}function g(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!l++||i!==e.debounceRendering)&&((i=e.debounceRendering)||s)(y)}function y(){for(var t;l=n.length;)t=n.sort(function(t,e){return t.__v.__b-e.__v.__b}),n=[],t.some(function(t){var e,n,l,s,i,o,r;t.__d&&(o=(i=(e=t).__v).__e,(r=e.__P)&&(n=[],(l=_({},i)).__v=l,s=x(r,i,l,e.__n,void 0!==r.ownerSVGElement,null,n,null==o?v(i):o),C(n,i),s!=o&&m(i)))})}function b(t,e,n,l,s,i,o,u,_){var h,p,f,d,m,g,y,b=n&&n.__k||a,k=b.length;if(u==r&&(u=null!=i?i[0]:k?v(n,0):null),h=0,e.__k=S(e.__k,function(n){if(null!=n){if(n.__=e,n.__b=e.__b+1,null===(f=b[h])||f&&n.key==f.key&&n.type===f.type)b[h]=void 0;else for(p=0;p<k;p++){if((f=b[p])&&n.key==f.key&&n.type===f.type){b[p]=void 0;break}f=null}if(d=x(t,n,f=f||r,l,s,i,o,u,_),(p=n.ref)&&f.ref!=p&&(y||(y=[]),f.ref&&y.push(f.ref,null,n),y.push(p,n.__c||d,n)),null!=d){var a;if(null==g&&(g=d),void 0!==n.__d)a=n.__d,n.__d=void 0;else if(i==f||d!=u||null==d.parentNode){t:if(null==u||u.parentNode!==t)t.appendChild(d),a=null;else{for(m=u,p=0;(m=m.nextSibling)&&p<k;p+=2)if(m==d)break t;t.insertBefore(d,u),a=u}"option"==e.type&&(t.value="")}u=void 0!==a?a:d.nextSibling,"function"==typeof e.type&&(e.__d=u)}else u&&f.__e==u&&u.parentNode!=t&&(u=v(f))}return h++,n}),e.__e=g,null!=i&&"function"!=typeof e.type)for(h=i.length;h--;)null!=i[h]&&c(i[h]);for(h=k;h--;)null!=b[h]&&N(b[h],b[h]);if(y)for(h=0;h<y.length;h++)A(y[h],y[++h],y[++h])}function S(t,e,n){if(null==n&&(n=[]),null==t||"boolean"==typeof t)e&&n.push(e(null));else if(Array.isArray(t))for(var l=0;l<t.length;l++)S(t[l],e,n);else n.push(e?e("string"==typeof t||"number"==typeof t?p(null,t,null,null,t):null!=t.__e||null!=t.__c?p(t.type,t.props,t.key,null,t.__v):t):t);return n}function k(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]="number"==typeof n&&!1===u.test(e)?n+"px":null==n?"":n}function w(t,e,n,l,s){var i,o,r,a,u;if(s?"className"===e&&(e="class"):"class"===e&&(e="className"),"style"===e)if(i=t.style,"string"==typeof n)i.cssText=n;else{if("string"==typeof l&&(i.cssText="",l=null),l)for(a in l)n&&a in n||k(i,a,"");if(n)for(u in n)l&&n[u]===l[u]||k(i,u,n[u])}else"o"===e[0]&&"n"===e[1]?(o=e!==(e=e.replace(/Capture$/,"")),r=e.toLowerCase(),e=(r in t?r:e).slice(2),n?(l||t.addEventListener(e,B,o),(t.l||(t.l={}))[e]=n):t.removeEventListener(e,B,o)):"list"!==e&&"tagName"!==e&&"form"!==e&&"type"!==e&&"size"!==e&&!s&&e in t?t[e]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==e&&(e!==(e=e.replace(/^xlink:?/,""))?null==n||!1===n?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(e)?t.removeAttribute(e):t.setAttribute(e,n))}function B(t){this.l[t.type](e.event?e.event(t):t)}function x(t,n,l,s,i,o,r,a,u){var c,h,p,v,m,g,y,S,k,w,B=n.type;if(void 0!==n.constructor)return null;(c=e.__b)&&c(n);try{t:if("function"==typeof B){if(S=n.props,k=(c=B.contextType)&&s[c.__c],w=c?k?k.props.value:c.__:s,l.__c?y=(h=n.__c=l.__c).__=h.__E:("prototype"in B&&B.prototype.render?n.__c=h=new B(S,w):(n.__c=h=new d(S,w),h.constructor=B,h.render=F),k&&k.sub(h),h.props=S,h.state||(h.state={}),h.context=w,h.__n=s,p=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=B.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=_({},h.__s)),_(h.__s,B.getDerivedStateFromProps(S,h.__s))),v=h.props,m=h.state,p)null==B.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==B.getDerivedStateFromProps&&S!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(S,w),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(S,h.__s,w)||n.__v===l.__v&&!h.__){for(h.props=S,h.state=h.__s,n.__v!==l.__v&&(h.__d=!1),h.__v=n,n.__e=l.__e,n.__k=l.__k,h.__h.length&&r.push(h),c=0;c<n.__k.length;c++)n.__k[c]&&(n.__k[c].__=n);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(S,h.__s,w),null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,m,g)})}h.context=w,h.props=S,h.state=h.__s,(c=e.__r)&&c(n),h.__d=!1,h.__v=n,h.__P=t,c=h.render(h.props,h.state,h.context),n.__k=null!=c&&c.type==f&&null==c.key?c.props.children:Array.isArray(c)?c:[c],null!=h.getChildContext&&(s=_(_({},s),h.getChildContext())),p||null==h.getSnapshotBeforeUpdate||(g=h.getSnapshotBeforeUpdate(v,m)),b(t,n,l,s,i,o,r,a,u),h.base=n.__e,h.__h.length&&r.push(h),y&&(h.__E=h.__=null),h.__e=!1}else null==o&&n.__v===l.__v?(n.__k=l.__k,n.__e=l.__e):n.__e=L(l.__e,n,l,s,i,o,r,u);(c=e.diffed)&&c(n)}catch(t){n.__v=null,e.__e(t,n,l)}return n.__e}function C(t,n){e.__c&&e.__c(n,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(t){t.call(n)})}catch(t){e.__e(t,n.__v)}})}function L(t,e,n,l,s,i,o,u){var _,c,h,p,f,d=n.props,v=e.props;if(s="svg"===e.type||s,null!=i)for(_=0;_<i.length;_++)if(null!=(c=i[_])&&((null===e.type?3===c.nodeType:c.localName===e.type)||t==c)){t=c,i[_]=null;break}if(null==t){if(null===e.type)return document.createTextNode(v);t=s?document.createElementNS("http://www.w3.org/2000/svg",e.type):document.createElement(e.type,v.is&&{is:v.is}),i=null,u=!1}if(null===e.type)d!==v&&t.data!=v&&(t.data=v);else{if(null!=i&&(i=a.slice.call(t.childNodes)),h=(d=n.props||r).dangerouslySetInnerHTML,p=v.dangerouslySetInnerHTML,!u){if(d===r)for(d={},f=0;f<t.attributes.length;f++)d[t.attributes[f].name]=t.attributes[f].value;(p||h)&&(p&&h&&p.__html==h.__html||(t.innerHTML=p&&p.__html||""))}(function(t,e,n,l,s){var i;for(i in n)"children"===i||"key"===i||i in e||w(t,i,null,n[i],l);for(i in e)s&&"function"!=typeof e[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===e[i]||w(t,i,e[i],n[i],l)})(t,v,d,s,u),e.__k=e.props.children,p||b(t,e,n,l,"foreignObject"!==e.type&&s,i,o,r,u),u||("value"in v&&void 0!==v.value&&v.value!==t.value&&(t.value=null==v.value?"":v.value),"checked"in v&&void 0!==v.checked&&v.checked!==t.checked&&(t.checked=v.checked))}return t}function A(t,n,l){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,l)}}function N(t,n,l){var s,i,o;if(e.unmount&&e.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||A(s,null,n)),l||"function"==typeof t.type||(l=null!=(i=t.__e)),t.__e=t.__d=void 0,null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){e.__e(t,n)}s.base=s.__P=null}if(s=t.__k)for(o=0;o<s.length;o++)s[o]&&N(s[o],n,l);null!=i&&c(i)}function F(t,e,n){return this.constructor(t,n)}e={__e:function(t,e){for(var n,l;e=e.__;)if((n=e.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(l=!0,n.setState(n.constructor.getDerivedStateFromError(t))),null!=n.componentDidCatch&&(l=!0,n.componentDidCatch(t)),l)return g(n.__E=n)}catch(e){t=e}throw t}},d.prototype.setState=function(t,e){var n;n=this.__s!==this.state?this.__s:this.__s=_({},this.state),"function"==typeof t&&(t=t(n,this.props)),t&&_(n,t),null!=t&&this.__v&&(e&&this.__h.push(e),g(this))},d.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),g(this))},d.prototype.render=f,n=[],l=0,s="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o=r;const P=100,E=0,M=1,O=2,U=3;class D{constructor(t){this.alive=new Int8Array(P*P),this.buffer=new Int8Array(P*P),this.setFromString(t)}static calculate(t,e,n){const[l,s]=D.parseRules(t);n.fill(0);for(let t=P+1;t<P*(P-1)-1;t++)e[t]&&(n[t-P-1]++,n[t-P]++,n[t-P+1]++,n[t-1]++,n[t+1]++,n[t+P-1]++,n[t+P]++,n[t+P+1]++);for(let t=P+1;t<P*(P-1)-1;t++)n[t]=e[t]&&s[n[t]]||!e[t]&&l[n[t]]?1:0;return n}static parseRules(t){let[e,n,l]=t.match(/B([0-9]*)\/S([0-9]*)/);return[n,l].map(t=>{let e=new Int8Array(9);if(t)for(let n of t.split(""))e[n]=1;return e})}static fragmentOf(t,e){let n=[];for(let l=e[M];l<e[M]+e[U];l++){let s=t.slice(l*P+e[E],l*P+e[E]+e[O]);n.push(Array.from(s))}return n}setFromString(t){let e=t.split("\n").map(t=>t.split("").map(t=>"#"==t?1:0)),n=Math.ceil(P/2-e.length/2),l=Math.ceil(P/2-e[0].length/2);for(let t=0;t<e.length;t++){let s=e[t];for(let i=0;i<s.length;i++)e[t][i]&&this.set([i+l,t+n])}}peekFragment(t){D.calculate(t,this.alive,this.buffer)}cycle(t){D.calculate(t,this.alive,this.buffer);let e=this.alive;return this.alive=this.buffer,this.buffer=e,this}isAlive(){return this.alive.indexOf(1)>=0}get(t){return this.alive[t[0]+t[1]*P]}set(t,e=!0){return this.alive[t[0]+t[1]*P]=e?1:0,this}setAll(t){this.alive.set(t),this.buffer.set(t)}toggle(t,e=!0){return this.set(t,!this.get(t))}fragment(t){return D.fragmentOf(this.alive,t)}bufferFragment(t){return D.fragmentOf(this.buffer,t)}clear(){this.alive.fill(0),this.buffer.fill(0)}}class T{constructor(t){this.config=t,this.buttons={},this.history=[];let[e,n]=T.parseConfig(t);this.automata=new D(n),this.setCardsFromList(e)}static parseConfig(t){return t.match(/(.*)\n([^]*)/).slice(1)}setCardsFromList(t){for(let e of t.split(/[;\n]/)){let t=1;e=(e=e.replace(/\*([0-9]+)/,e=>(t=Number(e.substr(1)),""))).trim(),this.buttons[e]=(this.buttons[e]||0)+t}console.log(this.buttons)}play(t){this.buttons[t]&&(this.history.push({move:t,state:new Int8Array(this.automata.alive)}),this.automata.cycle(t),this.buttons[t]--)}undo(){let t=this.history.pop();this.buttons[t.move]=(this.buttons[t.move]||0)+1,this.automata.setAll(t.state)}canUndo(){return this.history.length>0}}const I=[20,20,60,60];function W(t){return[...t.parentElement.childNodes].indexOf(t)}const H="\nB/S1; B2/S; B3/S\n.##\n##.\n.#.\n===  \nB/S0; B/S1; B/S2; B/S5\n######\n######\n.#####\n######\n######\n#####.\n===  \nB/S0; B1/S; B/S12; B/S123; B/S234; B/S345\n######\n######\n######\n######\n######\n######\n===  \nB1/S*2; B2/S*2; B3/S*2; B4/S*2\n....#\n...#.\n..#..\n.#...\n#....\n===  \nB1/S*2; B2/S*2; B3/S*2; B4/S*2\n#\n===  \nB/S0; B/S1; B/S2; B/S3; B2/S\n#####\n.....\n#####\n.....\n#####\n===  \nB/S0; B/S1; B/S2; B/S3; B/S4; B1/S\n#####\n..#..\n.###.\n#...#\n#####\n===  \nB/S0; B/S1; B/S2; B3/S\n#######\n===  \nB/S0; B/S1; B/S2; B/S3; B2/S01234\n#######\n.......\n#######\n===  \nB/S0; B/S1; B/S2; B/S3; B/S4; B2/S0*2\n####.##\n#.....#\n##.####\n".split("===").map(t=>t.trim());class R extends d{constructor(){super(...arguments),this.state={game:new T(H[0]),levels:H},this.preview=!1}hasButtons(){return Math.max.apply(null,Object.values(this.state.game.buttons))>=1}playLevel(t){this.setState({game:new T(t)})}render(e,{game:n,showLevels:l}){return h("div",null,h("button",{class:"top-left-levels",onClick:()=>this.showLevels()},">>"),h("div",{class:"levels"+(l?" active":"")},h("button",{onClick:()=>this.showLevels()},"<<"),H.map((t,e)=>h("button",{onClick:()=>{this.playLevel(t),this.showLevels()}},e,". ",T.parseConfig(t)[0],h("div",{class:"preview"},T.parseConfig(t)[1].replace(/\./g,"□").replace(/#/g,"■"))))),h("div",{class:"status"},n.automata.isAlive()?this.hasButtons()?"":h("div",null,"Success. ",this.levelInd()==this.state.levels.length-1?"This is the last level":h("button",{class:"extreme",onClick:()=>this.nextLevel()},"Next Level")):h("div",null,"Failure. All cells are dead.",h("button",{class:"extreme",onClick:()=>this.restartLevel()},"Restart"))),h("div",{class:"board"},this.renderFragment()),h("div",{class:"buttons"},Object.keys(n.buttons).map(t=>h("div",{style:"height:30px"},h("button",{class:"extreme",disabled:!n.buttons[t],onClick:()=>this.pressButton(t),onMouseOver:()=>{this.preview=!0,this.predict(t)},onMouseOut:()=>{this.preview=!1,this.predict(null)}},t+(n.buttons[t]>1?"*"+n.buttons[t]:""))))),h("div",{class:"menu"},h("button",{onClick:()=>this.showLevels()},"Levels"),h("button",{style:"z-index:10",onClick:()=>this.showHelp()},"Instructions"),h("button",{style:n.canUndo()?"":"visibility:hidden",onMouseOver:()=>{this.preview=!0,this.predict("undo")},onMouseOut:()=>{this.preview=!1,this.predict(null)},onClick:()=>this.undo()},"Undo")),h("div",{style:this.state.instructionsVisible?"":"display:none",class:"instructions"},t.instructions,h("button",{onClick:()=>this.showHelp()},"OK")))}pressButton(t){this.state.game.play(t),this.setState({game:this.state.game,peek:null})}get automata(){return this.state.game.automata}renderFragment(){let t=this.automata.fragment(I),e=this.automata.bufferFragment(I),n=t.map((t,n)=>t.map((t,l)=>[t,this.state.peek?e[n][l]:t]));return this.props.asString?h("span",null,n.map(t=>t.map(([t,e])=>"□-+■"[t+2*e]).join("")).join("\n")):h("table",{class:"grid",onClick:t=>{let e=t.target;if("TD"==e.nodeName&&t.shiftKey){let[t,n]=[W(e),W(e.parentElement)];this.automata.toggle([t+I[0],n+I[1]]),this.setState({game:this.state.game})}}},n.map(t=>h("tr",null,t.map(([t,e])=>h("td",{class:(t?"alive ":"")+(e?"nextAlive":"")})))))}predict(t){t&&("undo"==t?this.automata.buffer.set(this.state.game.history[this.state.game.history.length-1].state):this.automata.peekFragment(t)),this.setState({peek:t})}clear(){this.automata.clear()}undo(){this.state.game.undo(),this.setState(this.state)}showLevels(){this.setState({showLevels:!this.state.showLevels})}showHelp(){this.setState({instructionsVisible:!this.state.instructionsVisible})}levelInd(){return this.state.levels.indexOf(this.state.game.config)}nextLevel(){let t=this.levelInd();this.playLevel(this.state.levels[t+1])}restartLevel(){this.playLevel(this.state.game.config)}}window.onload=(()=>{!function(t,n,l){var s,i,u;e.__&&e.__(t,n),i=(s=l===o)?null:l&&l.__k||n.__k,t=h(f,null,[t]),u=[],x(n,(s?n:l||n).__k=t,i||r,r,void 0!==n.ownerSVGElement,l&&!s?[l]:i?null:a.slice.call(n.childNodes),u,l||r,s),C(u,t)}(h(R,null),document.body)})}();
//# sourceMappingURL=bundle.js.map
